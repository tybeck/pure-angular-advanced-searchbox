"use strict";angular.module("paasb",["paasb.config"]),angular.module("paasb.config",[]).constant("FILTERS",{SELECTORS:[{name:"Contains",key:"contains",selected:!0,notAllowed:["restrictedSuggestedValues"]},{name:"Does not contain",key:"doesNotContain",notAllowed:["restrictedSuggestedValues"]},{name:"Is Equal To",key:"isEqualTo"},{name:"Is Not Equal To",key:"isNotEqualTo"},{name:"Starts with",key:"startsWith"},{name:"Ends with",key:"endsWith"},{name:"Similiarity",key:"similiarity"}],OPERATORS:[{name:"AND",selected:!0},{name:"OR"}]}),angular.module("paasb").directive("paasbAutoSize",["$parse","$window","$timeout","paasbUtils",function(a,b,c,d){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,e,f){var g=null,h=a(f.paasbAutoSizeElement)(b),i=a(f.paasbAutoSizeBoundingBox)(b);b.reAutoSize=function(){var a=0;i&&i.length&&(i=i[0]),c(function(){var b=g.element.find("input")[0],c=i||b,f=c.getBoundingClientRect(),j=(g.element[0].getBoundingClientRect(),f.left);if(b===c){var k,l=g.element.find("div")[2];l||(l=g.element.find("ul")[0]),l&&(k=l.getBoundingClientRect().left,j-=k)}if(h){var m=angular.element(h),n=e[0];m[0].contains(n)||(a=m.find("ul")[0].getBoundingClientRect().height+f.height)}var o=d.getStyle(b,"border-left-width");e.css("left",j+"px").css("width",f.width-o+"px").css("top",a?a+"px":"auto")})},f.$observe("paasbAutoSize",function(){g=a(f.paasbAutoSize)(b),angular.element(e).ready(function(){b.reAutoSize()})})}]}}]),angular.module("paasb").directive("paasbDraggable",["paasbUtils",function(a){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,d){c.on("dragstart dragend",function(c){switch(c.type){case"dragstart":var d=angular.element(this),e=a.uuid(),f={id:e,draggable:!0,trash:!0};d.attr("id")||d.attr("id",e),c.dataTransfer.setData("text",JSON.stringify(f));break;case"dragend":if(b.Search&&b.Search.Filtering){var g=b.Search.Filtering;g.removeClassAllFilters("over-placement-1").removeClassAllFilters("over-placement-2").removeClassAllFilters("over-placement-3").removeClassAllFilters("dragged-item")}}})}]}}]),angular.module("paasb").directive("paasbSearchBoxAddedFilter",["$timeout","$document","paasbUi","paasbUtils",function(a,b,c,d){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-added-filter.html",require:"^paasbSearchBoxFiltering",scope:{filter:"=",filtering:"=",toValue:"=",operators:"="},controller:["$scope","$element","$attrs",function(e,f,g){var h,i=e.filtering,j=e.filter,k=(e.operators,null),l=null,m=0;if(j.loading=!1,f.attr("id",d.uuid()),"string"==typeof j.suggestedValues){k=i.getConfig();var n=d.getDeepValue(k,j.suggestedValues);n&&(j.suggestedValues=n)}e.toValue&&(e.value=e.toValue,e.dontOpen=!0),d.isURL(j.suggestedValues)||d.isURL(j.source)&&j.reloadOnCreate?(c.safeApply(e,function(){var a=j.source||j.suggestedValues;angular.extend(j,{loading:!0,suggestedValues:[],source:a})}),i.loadSource(j).then(function(a){c.safeApply(e,function(){angular.extend(j,{suggestedValues:a,loading:!1,value:""})})})):j.value="",c.extend(e,{Utils:d,getDirection:function(a){var b=null;if("undefined"==typeof a||null===a)return b;switch("string"==typeof a&&(a=parseInt(a)),a){case 1:b="before";break;case 3:b="after"}return b},events:{searchboxClick:function(a){var b=f[0].contains(a.target),c=f[0]==a.target,d=b||c;d||e.closeFilter()},inputKeyEvents:function(a){13===a.keyCode&&e.closeFilter()},dragEvents:function(a){switch(a.type){case"dragstart":l=angular.element(this),a.dataTransfer.effectAllowed="copyMove",l.attr("id")||l.attr("id",d.uuid()),a.dataTransfer.setData("text",l.attr("id")),l.addClass("dragged-item");break;case"dragenter":a.preventDefault(),m++;break;case"dragleave":m--,0===m&&angular.element(this).removeClass("over");break;case"dragover":var b=this.getBoundingClientRect(),c=b.width/3,f=Math.abs(Math.ceil((a.pageX-b.left)/c))||1;return i.removeClassAllFilters("over-placement-1").removeClassAllFilters("over-placement-2").removeClassAllFilters("over-placement-3"),angular.element(this).addClass("over-placement-"+f).attr("data-placement",f),a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="copyMove",!1;case"drop":a.stopPropagation&&a.stopPropagation();var g=a.dataTransfer.getData("text"),h=!1;if(d.isJson(g)&&(g=JSON.parse(g),h=!0),g){var j=g;h&&(j=g.id);var k=document.getElementById(j);if(h&&g.draggable)g.trash&&i.removeByElement(this);else if(k!==this){var f=parseInt(angular.element(this).attr("data-placement")||null),n=e.getDirection(f);i[2===f?"swapFilter":"moveFilter"](k,this,n)}}return!1;case"dragend":i.removeClassAllFilters("over-placement-1").removeClassAllFilters("over-placement-2").removeClassAllFilters("over-placement-3").removeClassAllFilters("dragged-item")}}},takeSuggestion:function(a){e.value=a},closeFilter:function(){var a=this;c.safeApply(e,function(){j.editing=!1,e.$broadcast("filter.isEditing",j.editing),b.unbind("click",a.events.searchboxClick),j.value?j.suggestedValue?j.value=j.suggestedValue.value:j.restrictedSuggestedValues&&i.remove(j):i.remove(j)})},openFilter:function(){if(!e.dontOpen){var c=this;j.editing||(j.editing=!0,e.$broadcast("filter.isEditing",j.editing),a(function(){b.bind("click",c.events.searchboxClick)},25),e.setFocus())}e.dontOpen=!1},destroy:function(){return i.remove(e.filter,null,!1)},getElements:function(){return h=f.find("input"),e},registerEvents:function(a){return h.on("keyup",a.inputKeyEvents),f.on("dragstart dragenter dragover dragleave drop dragend",a.dragEvents),e},setFocus:function(){return a(function(){h&&h[0].focus()},50),e},addWatch:function(){return e.$watch("value",function(a){j.value=a||"",j.value&&i.update()}),e}}),e.getElements().registerEvents(e.events).addWatch().openFilter()}]}}]),angular.module("paasb").directive("paasbSearchBoxAutoComplete",["$window","$document","$timeout","$interpolate","paasbUi","paasbUtils","paasbAutoComplete","paasbMemory",function(a,b,c,d,e,f,g,h){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-auto-complete.html",require:"^paasbSearchBox",scope:{query:"=",config:"=",input:"="},controller:["$scope","$element",function(i,j){var k=i.config,l=h.getAndSet("query");i.$watch("query",function(a){i.tookSuggestion!==a&&(i.tookSuggestion=null,a&&l!==a&&g.load(d(k.autoCompleteUrl)({query:a})).then(function(a){e.extend(i,{autoSuggestions:a,showSuggestions:!(!a||!a.length)}),i.position()}))}),angular.extend(i,{Utils:f,tookSuggestion:null,showSuggestions:!1,autoCompleteClick:function(a){var c=a.target,d=j[0];d.contains(c)||e.extend(i,{showSuggestions:!1}),b.unbind("click",i.autoCompleteClick)},position:function(){c(function(){var a=i.input[0],b=f.getStyle(a,"padding-left"),c=f.getStyle(a,"width")-f.getStyle(a,"padding-right")-b;j.css("left",b+"px").css("width",c+"px")})},takeAutoComplete:function(a){e.extend(i,{showSuggestions:!1,tookSuggestion:a}),i.$emit("take.autoSuggestion",a),b.unbind("click",i.autoCompleteClick)},registerEvents:function(){return angular.element(a).on("resize",function(){i.position()}),i.$on("input.focused",function(){i.autoSuggestions&&i.autoSuggestions.length&&e.extend(i,{showSuggestions:!0})}),i.$watch("showSuggestions",function(a){a&&b.bind("mousedown",i.autoCompleteClick)}),i}}),i.registerEvents()}]}}]),angular.module("paasb").directive("paasbSearchBoxCacheFilter",["paasbMemory","paasbUi",function(a,b){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-cache-filters.html",require:"^paasbSearchBox",controller:["$scope",function(c){b.extend(c,{cacheActive:a.getAndSet("cache")||!1,handleCache:function(){c.paasbSearchBoxCacheFilterPermanent||(c.cacheActive=!c.cacheActive,a.getAndSet("cache",c.cacheActive))}})}]}}]),angular.module("paasb").directive("paasbSearchBoxFilterMovedAnimation",["paasbUtils","paasbUi",function(a,b){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-filter-moved-animation.html",require:"^paasbSearchBoxAddedFilter",scope:{filter:"="},controller:["$scope","$element",function(c,d){var e=c.filter,f=d.parent(),g=null,h=null,i=0,j=0,k=0;if(e){g=e.element,h=f[0].getBoundingClientRect(),k=a.getStyle(f[0],"border-radius")||0,i=h.bottom-h.top,j=h.width;var l=j/2+6,m=i/2+6;d.css("border-left-width",l+"px").css("border-right-width",l+"px").css("border-top-width",m+"px").css("border-bottom-width",m+"px").css("border-radius",k+"px"),b.apply(function(){d.addClass("transition").css("border-left-width","0px").css("border-right-width","0px").css("border-top-width","0px").css("border-bottom-width","0px").css("border-radius",k+"px").css("width",j+"px").css("height",i+"px")},50)}}]}}]),angular.module("paasb").directive("paasbSearchBoxFilterMoved",["$parse","$compile",function(a,b){return{restrict:"A",controller:["$scope","$element","$attrs",function(c,d,e){var f=null;c.hasRecentlyMoved=function(){if(f&&f.recentlyMoved){var a=c.$new(!0),e=null;angular.extend(a,{filter:f}),e=b('<paasb-search-box-filter-moved-animation filter="filter" />')(a),d.prepend(e)}delete f.recentlyMoved},e.$observe("paasbSearchBoxFilterMoved",function(){f=a(e.paasbSearchBoxFilterMoved)(c),angular.element(d).ready(function(){c.hasRecentlyMoved()})})}]}}]),angular.module("paasb").directive("paasbSearchBoxFilterOperators",["$document","paasbUi","FILTERS",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-filter-operators.html",require:"^paasbSearchBoxAddedFilter",scope:{filtering:"=",filter:"="},controller:["$scope","$element","$attrs",function(d,e,f){var g=d.filtering,h=angular.copy(c.OPERATORS),i=d.filter;g.getFilterCount()>1&&(d.hasOperator=!0,d.autoSizeElement=e,angular.extend(d,{availableOperators:h,showOperators:!1,events:{docClick:function(c){var f=e[0].contains(c.target),g=e[0]==c.target,h=f||g;h||(a.unbind("click",d.events.docClick),b.extend(d,{showOperators:!1}))}},openOperators:function(){d.showOperators=!d.showOperators,a[d.showOperators?"bind":"unbind"]("click",d.events.docClick),d.reAutoSize()},takeOperator:function(a){angular.forEach(h,function(a){a.selected=!1}),d.operator=a,g.addOperatorToFilter(a,i),a.selected=!0},takeOperatorByName:function(a){angular.forEach(h,function(b){b.name!==a?b.selected=!1:(b.selected=!0,d.operator=b)})},setDefaultOperator:function(){var a=g.getOperatorByFilterIndex(i);if(null===a){if(i.operator)angular.forEach(h,function(a){a.selected=a.key===i.selector.key});else if(angular.forEach(h,function(a){a.selected&&(d.operator=a)}),!i.selector&&h&&h.length){var b=h[0];b.selected=!0,d.operator=b}}else this.takeOperatorByName(a);return d},registerOperator:function(){return g.registerOperator(d),d},addOperatorToFilter:function(){return g.hasOperatorAlready(i)||(g.addOperatorToFilter(d.operator,i,!0),console.log("okay")),d}}),d.setDefaultOperator().registerOperator().addOperatorToFilter())}]}}]),angular.module("paasb").directive("paasbSearchBoxFilterSelectors",["FILTERS",function(a){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-filter-selectors.html",require:"^paasbSearchBoxAddedFilter",scope:{filtering:"=",filter:"="},controller:["$scope","$element","$attrs",function(b,c,d){var e=b.filtering,f=angular.copy(a.SELECTORS),g=b.filter;b.autoSizeElement=c,angular.extend(b,{availableSelectors:null,filter:angular.extend(g,{hasFilterSelectors:c}),takeSelector:function(a){angular.forEach(b.availableSelectors,function(a){a.selected=!1}),g.selector=a,a.selected=!0,g.value&&e.update(),b.reAutoSize();var c=g.element.find("input")[0];c.focus()},setDefaultSelector:function(){if(g.selector)angular.forEach(b.availableSelectors,function(a){a.selected=a.key===g.selector.key});else if(angular.forEach(b.availableSelectors,function(a){a.selected&&(g.selector=a)}),!g.selector&&b.availableSelectors&&b.availableSelectors.length){var a=b.availableSelectors[0];a.selected=!0,g.selector=a}return b},setAvailableSelectors:function(){var a=[];return angular.forEach(f,function(b){var c=!0;angular.forEach(b.notAllowed,function(a){g[a]&&(c=!1)}),c&&a.push(b)}),b.availableSelectors=a,b}}),b.$on("filter.isEditing",function(a,c){c&&b.reAutoSize()}),b.setAvailableSelectors().setDefaultSelector()}]}}]),angular.module("paasb").directive("paasbSearchBoxFiltering",["$document","$timeout","$window","paasbUtils","paasbUi",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-filtering.html",require:"^paasbSearchBox",scope:{filters:"=",search:"="},controller:["$scope","$element","$attrs",function(f,g,h){var i=null;f.$watch("active",function(c,d){c&&!f.windowClickedFn?b(function(){f.windowClickedFn=a.on("click",f.windowClicked)},25):f.windowClickedFn&&(a.off("click",f.windowClicked),f.windowClickedFn=null)}),angular.extend(f,{active:!1,Utils:d,windowClicked:function(a){var b=a.target,c=g[0];c.contains(b)||e.extend(f,{active:!1})},position:function(){f.active&&b(function(){var a=g.parent(),b=g.find("ul"),c=(b[0].getBoundingClientRect(),a[0].getBoundingClientRect());b.css("top",c.height-5+"px").css("width",c.width+d.getStyle(a[0],"padding-right")+d.getStyle(a[0],"padding-left")-d.getScrollbarWidth()/2+"px")},25)},toggleFilters:function(){e.extend(f,{active:!f.active}),this.position()},addFilterAndClose:function(a){i.Filtering.add(a),e.extend(f,{active:!f.active})},registerEvents:function(){angular.element(c).on("resize",function(){f.position()})},addFilter:function(a){var b=this,c=d.getParentByAttribute(a.target,"li","data-filter-name"),e=c.attr("data-filter-name");angular.forEach(f.filters,function(a){a.name===e&&(a.restrictedSuggestedValues?b.addFilterAndClose(a):a.multi?b.addFilterAndClose(a):(a.notFiltered=!a.notFiltered,a.notFiltered||b.addFilterAndClose(a)))})}}),f.$watch("search",function(a,b){a!==b&&angular.isObject(a)&&(i=a,f.filters=angular.copy(f.filters),f.filters.slice().reverse().forEach(function(a,b,c){a.notFiltered=!0,a.root&&(a.filteredFrom='<i class="fa fa-level-up"></i> (Derived from Root <i class="fa fa-angle-double-right"></i> '+a.root+")"),a.child&&(a.filteredFrom='<i class="fa fa-level-down"></i> (Derived from '+a.child+")"),a.dontFilter&&f.filters.splice(c.length-1-b,1)}),f.registerEvents())})}]}}]),angular.module("paasb").directive("paasbSearchBoxGrouping",[function(){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox-grouping.html",require:"^paasbSearchBox",controller:["$scope","$element","$attrs",function(a,b,c){angular.extend(a,{addGrouping:function(){console.log("add grouping")}})}]}}]),angular.module("paasb").directive("paasbSearchBox",["$timeout","$window","paasbApi","paasbUi","paasbFiltering","paasbPlaceholders","paasbMemory","paasbUtils","FILTERS",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",replace:!0,templateUrl:"views/directives/searchbox.html",scope:{searchParams:"=?",paasbSearchBoxFiltering:"=?",paasbSearchBoxConfig:"=?",paasbSearchBoxAutoComplete:"=?",paasbSearchBoxCacheFilter:"=?",paasbSearchBoxEnableFilteringOperators:"=?",paasbSearchBoxFilterSelectors:"=?",paasbSearchBoxFilterOperators:"=?",paasbSearchBoxEnableGrouping:"=?",placeholder:"@"},controller:["$scope","$element","$attrs",function(b,j,k){var l=null,m=null,n=null,o=null,p=null,q=null,r={searchInputId:"searchInput-"+h.uuid(),hasAutoCompleteConfigurations:function(){return m&&m.autoCompleteUrl},make:function(a,c,d,e){var f=b[a];return angular[d]?angular[d](f)?c&&_.isEmpty(f)&&(b[a]=c,b[e]=c[e]):f="isObject"===d?angular.extend({},c):c:this[d]&&(f=this[d](f)),this},events:{handleEraser:function(){b.query=""},handleGarbage:function(){(l.query&&l.query.length||b.hasFilters)&&(o.removeAll(!0,!0,{deleteOperators:!0}),b.query="")}},shouldStore:function(){return!(!g.getAndSet("cache")&&!b.paasbSearchBoxConfig.store)},configure:function(){var a={query:"",filters:{}};return b.paasbSearchBoxEnableFilteringOperators&&angular.extend(a,{operators:[]}),i&&i.SELECTORS&&b.paasbSearchBoxFilterSelectors&&(i.SELECTORS=b.paasbSearchBoxFilterSelectors),i&&i.OPERATORS&&b.paasbSearchBoxFilterOperators&&(i.OPERATORS=b.paasbSearchBoxFilterOperators),this.make("searchParams",this.shouldStore()?g.getAll():a,"isObject","query").make("paasbSearchBoxFiltering",[],"isArray").make("paasbSearchBoxConfig",{},"isObject").make("paasbSearchBoxAutoComplete",{},"isObject"),b.query&&(b.hasQuery=!0),this.shouldStore()||g.removeAll(),b.paasbSearchBoxConfig&&b.paasbSearchBoxConfig.store&&(b.paasbSearchBoxCacheFilter=!0),l=b.searchParams,m=b.paasbSearchBoxConfig,n=b.paasbSearchBoxAutoComplete,b.autoCompleteEnabled=this.hasAutoCompleteConfigurations(),d.extend(b,{searchInputId:this.searchInputId}),this},send:function(a){return angular.extend(a,{$$lastChange:(new Date).getTime()}),b.$emit("onChange",a),this},addEvents:function(){var c=this;return angular.extend(b,this.events),o.watch(function(d,e,f){b.paasbSearchBoxEnableFilteringOperators&&g.getAndSet("operators",e),q&&a.cancel(q),m.delay&&!f?(l.filters=d,b.paasbSearchBoxEnableFilteringOperators&&(l.operators=e),q=a(function(){c.send(l)},m.delay)):(l.filters=d,b.paasbSearchBoxEnableFilteringOperators&&(l.operators=e),c.send(l))}),b.$on("take.autoSuggestion",function(a,c){b.skipDelay=!0,b.query=c}),b.$watch("query",function(e){"undefined"!=typeof e&&g.getAndSet("query")!==e&&(g.getAndSet("query",e),d.extend(b,{hasQuery:!(!e||!e.length)}),m.delay&&!b.skipDelay?(q&&a.cancel(q),q=a(function(){l.query=e,c.send(l)},m.delay)):(q&&a.cancel(q),b.skipDelay=!1,l.query=e,c.send(l)))}),b.input.on("focus",function(){b.$broadcast("input.focused")}),this},register:function(){return o=new e(b,m),p=new f(b,m),angular.extend(b,{Search:{Filtering:o,Placeholding:p}}),o.addMemoryOperators().addByMemory(l),p.setup(),b.$emit("onRegisterApi",this.getAPI()),this},getAPI:function(){return new c(b,o,p)},dom:function(){var a=angular.element(document.getElementById(this.searchInputId)),c=h.getParentByAttribute(a[0],"div","data-search-box"),e=a.parent();return d.extend(b,{input:a,wrapper:e,box:c}),this}};angular.element(j).ready(function(){r.configure().dom().register().addEvents().send(l)})}]}}]),angular.module("paasb").filter("paasbClean",[function(){return function(a,b){if(a&&!a.$$timestamp&&(a.$$timestamp=(new Date).getTime()),a.$$modified=(new Date).getTime(),b)if("function"==typeof b)a.modifiedValue=b(a.value);else if(angular.isArray(b)){var c=a.value;angular.forEach(b,function(a){c=a(c)}),a.modifiedValue=c}return a}}]),angular.module("paasb").filter("paasbSuggest",[function(){return _.memoize(function(a,b,c,d){if(!b){var e=[];return angular.forEach(a,function(a){e.push({modified:a,value:a})}),e}var f=[],g=new String(b);return angular.forEach(a,function(a){var b=a.toLowerCase(),c=g.toLowerCase();if(-1!==b.indexOf(c)){for(var d=[],e=!0,h=-1;e;)if(h=b.indexOf(c,d.length?h+1:h),-1!==h){var i=c.length;d.push({start:h,end:i,len:i-1})}else e=!1;var j=a,k=0;angular.forEach(d,function(a){var b=j.substr(0,a.start+k),c="<b>"+j.substr(a.start+k,a.end)+"</b>",d=j.substr(a.start+k+1+a.len,j.length);j=b+c+d,k+=7})}j&&f.push({modified:j,value:a})}),c.suggestedValue=f&&f.length?f[0]:null,f},function(a,b){return a.length+b})}]),angular.module("paasb").factory("paasbApi",["$q","$http","paasbUi",function(a,b,c){return function(a,b,d){return{Filtering:b,Placeholding:d,Loading:{set:function(b){"boolean"==typeof b&&c.extend(a,{isLoading:b})}},destroy:function(){d&&d.stopAll(),a.$destroy()}}}}]),angular.module("paasb").factory("paasbAutoComplete",["$q","$http",function(a,b){var c={load:function(c){var d=a.defer();return b({method:"GET",url:c}).then(function(a){a&&a.data&&d.resolve(a.data)},function(){d.resolve([])}),d.promise}};return c}]),angular.module("paasb").factory("paasbFiltering",["$q","$filter","$compile","$http","paasbUi","paasbUtils","paasbMemory","paasbValidation","FILTERS",function(a,b,c,d,e,f,g,h,i){var j=null,k=null;return function(l,m){j=l,k=m;var n=null;j.$watch("Search",function(a,b){angular.isObject(a)&&(n=a)}),angular.extend(j,{addedFilters:[],addedOperators:[],registeredOperators:[],addedScopes:{}}),angular.extend(this,{clean:b("paasbClean"),removeByElement:function(a){var b=this;return angular.forEach(j.addedFilters,function(c){c&&c.element[0]===a&&b.remove(c)}),this},removeClassAllFilters:function(a){return angular.forEach(j.addedFilters,function(b){if(b&&b.element){var c=b.element;c.removeClass(a)}}),this},getFilterByElement:function(a){var b=null;return angular.forEach(j.addedFilters,function(c,d){var e=c.element[0];c&&e===a&&(b={index:d,filter:c})}),b},moveFilter:function(a,b,c){var d=this.getFilterByElement(a),e=angular.copy(j.addedFilters);this.getOperators();if(d){e.splice(d.index,1);var f=this.getFilterByElement(b),g=null;switch(c){case"before":g=f.index;break;case"after":g=f.index+1}d.filter.recentlyMoved=!0,null!==g&&(g>e.length?e.push(d.filter):e.splice(g,0,d.filter)),this.rearrangeOperators(d,f),this.removeAll(!0,!1,{drag:!0}),this.addByMemory(e,!0)}},rearrangeOperators:function(a,b){var c=this.getOperators();if(c&&c.length){var d=a.index-1,e=b.index-1,f=j.addedOperators[d],g=j.addedOperators[e];-1!==d&&g&&(j.addedOperators[a.index-1]=g),-1!==e&&f&&(j.addedOperators[b.index-1]=f)}},swapFilter:function(a,b){var c=this.getFilterByElement(a),d=this.getFilterByElement(b);if(c&&d){var e=angular.copy(j.addedFilters),f=c.filter,g=d.filter;this.getOperators();e[c.index]=g,e[d.index]=f,this.rearrangeOperators(c,d),f.recentlyMoved=!0,this.removeAll(!0,!1,{drag:!0}),this.addByMemory(e,!0)}},getOperatorByFilterIndex:function(a){var b=null,c=0,d=null;return angular.forEach(j.addedFilters,function(c,d){a.uuid===c.uuid&&(b=d)}),c=b-1,-1!==Math.sign(c)&&(d=j.addedOperators[c],"undefined"==typeof d&&(d=null)),d},addOperatorToFilter:function(a,b,c){if(b){var d=null;if(angular.forEach(j.addedFilters,function(a,c){b.uuid===a.uuid&&(d=c)}),null!==d){var e=d-1;j.addedOperators[e]?j.addedOperators[e]=a.name:j.addedOperators.push(a.name)}}else j.addedOperators.push(a.name);c||this.update()},getOperatorsInMemory:function(){return g.getAndSet("operators")||[]},getOperators:function(){return j.addedOperators},hasOperatorAlready:function(a){var b=this.getOperators(),c=this.getFilters(),d=!1;return angular.forEach(b,function(b,e){angular.forEach(c,function(b,c){b.uuid===a.uuid&&c-1===e&&(d=!0)})}),d},addMemoryOperators:function(){var a=this.getOperatorsInMemory();return a&&a.length&&(j.addedOperators=a),this},getConfig:function(){return k},getFilters:function(){return j.addedFilters},getFilterCount:function(){return j.addedFilters.length},watch:function(a){this.callback=a},update:function(a){if(this.callback){var b=this.buildParameters();return g.getAndSet("filters",b),this.callback(b,j.addedOperators||[],a)}},buildParameters:function(){var a=[],b=this;return angular.forEach(j.addedFilters,function(c){var d=function(c){var d={},e=b.getOperatorByFilterIndex(c);e&&(d.$$operator=e);var f=angular.extend({condition:c.selector.key,value:c.value,name:c.name,$$timestamp:c.$$timestamp||null,$$modified:c.$$timestamp||null},d,c.extend||{});a.push(b.clean(f,c.middleware))};h.has(c)?h.validate(c)&&d(c):d(c)}),a},getFilterContainer:function(){if(!this.filterContainerId){this.filterContainerId=f.uuid();var a=document.createElement("div");a.id=this.filterContainerId,angular.element(a).attr("ng-hide","!addedFilters.length").addClass("paasb-added-filters-wrapper paasb-clearfix"),j.paasbSearchBoxEnableGrouping&&angular.element(a).prepend("<paasb-search-box-grouping />"),j.wrapper.parent().append(c(a)(j))}return angular.element(document.getElementById(this.filterContainerId))},addByMemory:function(a,b){var c=a.filters||a,d=this;return angular.forEach(c,function(a){b&&f.removeObjectProperties(a,["$filter","editing","element","filteredFrom","hasFilterSelectors","loading","notFiltered","selector","uuid"]),angular.forEach(j.paasbSearchBoxFiltering,function(b){a.name===b.name&&d.add(b,a)})}),this},registerOperator:function(a){j.registeredOperators.push(a)},addProperty:function(a,b,c){return b&&b[c]&&(a[c]=b[c]),this},add:function(a,b){var d=j.$new(!0),g=angular.copy(a),h=j.paasbSearchBoxEnableFilteringOperators;this.addProperty(g,b,"$$timestamp").addProperty(g,b,"$$modified"),angular.extend(d,{filter:g,filtering:this,operators:h,toValue:b&&b.value?b.value:null});var k=c('<paasb-search-box-added-filter filter="filter" filtering="filtering" operators="operators" to-value="toValue" />')(d);this.getFilterContainer().append(k),angular.extend(g,{element:k,$filter:a,uuid:f.uuid()}),b&&b.condition&&angular.forEach(i.SELECTORS,function(a){a.key===b.condition&&(g.selector=a)}),j.addedScopes[g.uuid]=d,e.safeApply(j,function(){j.hasFilters=!0,j.addedFilters.push(g)})},remove:function(a,b,c,d){var f=null,g=this,h=g.getOperators();j.addedFilters.forEach(function(b,c){b.uuid===a.uuid&&(f=c)}),j.addedFilters.slice().reverse().forEach(function(c,g,i){if(c.uuid===a.uuid){if(h&&h.length){var k=f-1;if(-1===Math.sign(k)){var l=f+1,m=j.addedFilters[l],n=null;m&&(n=j.addedScopes[m.uuid],e.extend(n,{operators:!1}))}else k=0;j.registeredOperators.splice(k,1),console.log(j.addedOperators),(!b||d&&d.deleteOperators)&&j.addedOperators.splice(k,1),console.log(j.addedOperators)}c.element.remove();var o=j.addedScopes[a.uuid];o&&(o.$destroy(),delete j.addedScopes[a.uuid]),a.$filter.notFiltered=!0,j.addedFilters.splice(i.length-1-g,1)}}),j.addedFilters&&!j.addedFilters.length&&(j.hasFilters=!1),b||("boolean"!=typeof c&&(c=!0),this.update(c))},removeAll:function(a,b,c){var d=this;j.addedFilters.slice().reverse().forEach(function(b){var e={deleteOperators:!0};return c&&c.drag&&delete e.deleteOperators,d.remove(b,a,void 0,e)}),a&&!b||g.removeAll(),b&&this.update()},loadSource:function(b){var c=a.defer();return d.get(b.source).then(function(a){return b.suggestedDataPoint?c.resolve(a&&a.data[b.suggestedDataPoint]?a.data[b.suggestedDataPoint]:null):c.resolve(a?a.data:null)}),c.promise}})}}]),angular.module("paasb").factory("paasbMemory",["$window",function(a){var b=a.localStorage,c={hash:"paasb",getAndSet:function(a,c){b.getItem(this.hash)||b.setItem(this.hash,"{}");var d=b.getItem(this.hash);if(d){if(d=JSON.parse(d),"undefined"==typeof c)return d[a];d[a]=c,b.setItem(this.hash,JSON.stringify(d))}},getAll:function(){var a=JSON.parse(b.getItem(this.hash));return a?(delete a.cache,a):{}},removeAll:function(){var a=this.getAndSet("cache"),c={};null!==a&&(c.cache=a),b.setItem(this.hash,JSON.stringify(c))}};return c}]),angular.module("paasb").factory("paasbPlaceholders",["$timeout",function(a){var b,c=null,d=null;return function(e,f){c=e,d=f,angular.extend(this,{index:0,position:0,val:"",stopAll:function(){a.cancel(b)},setup:function(){d&&d.placeholders&&d.placeholders.length?this.start(this.index):c.placeholder&&"string"==typeof c.placeholder&&c.input.attr("placeholder",c.placeholder)},start:function(a){"undefined"!=typeof a?this.index=a:"undefined"!=typeof this.index?this.index=0:this.index++,this.position=0,this.val="",this.change()},change:function(e){var f=this;b=e?a(function(){f.val=f.val.slice(0,f.val.length-1),c.input.attr("placeholder",f.val),f.val.length?f.change(!0):(f.position=0,f.index++,f.index>d.placeholders.length-1&&(f.index=0),f.change())},d.placeholderSpeedOutInterval||25):a(function(){var e=d.placeholders[f.index],g=e.length;f.val+=e[f.position],c.input.attr("placeholder",f.val),f.position++,f.position<g?f.change():b=a(function(){f.change(!0)},d.placeholderInterval||2e3)},d.placeholderSpeedInInterval||75)}})}}]),angular.module("paasb").factory("paasbUi",["$timeout",function(a){var b={extend:function(a,b){this.safeApply(a,function(){angular.extend(a,b)})},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$apply(b)},apply:function(b,c){return a(b,c||0)}};return b}]),angular.module("paasb").factory("paasbUtils",["$sce","$window",function(a,b){var c={uuid:function(){var a=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+Math.round(16*Math.random()))%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})},isJson:function(a){try{JSON.parse(a)}catch(a){return!1}return!0},removeObjectProperties:function(a,b){for(var c=0;c<b.length;c++)a.hasOwnProperty(b[c])&&delete a[b[c]]},getScrollbarWidth:function(){var a=document.createElement("div");a.className="scrollbar-measure",document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b},getParentByAttribute:function(a,b,c){var d=!0,e=null;for(a=angular.element(a);d&&a[0]!==document;){var f=a[0].nodeName.toLowerCase();if(f===b.toLowerCase()&&a.attr(c)){e=a,d=!1;break}a=a.parent()}return e},getStyle:function(a,c){return parseInt(b.getComputedStyle(a,null).getPropertyValue(c))},trust:function(b){return a.trustAsHtml(b)},isURL:function(a){var b="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$",c=new RegExp(b,"i");return c.test(a)},getDeepValue:function(a,b){for(var c,d=b.split("."),e=a,f=0;f<d.length;++f){if(c=e[d[f]],"undefined"==typeof c)return;e=c}return e}};return c}]),angular.module("paasb").factory("paasbValidation",["$window",function(a){var b={length:function(a,b){return a.length===parseInt(b)},min:function(a,b){return a.length>=parseInt(b)},max:function(a,b){return a.length<=parseInt(b)},between:function(a,b){var c=b.split(",");if(c&&2===c.length){var d=this.min(a,c[0]),e=this.max(a,c[1]);return d&&e}return!1},numeric:function(a){return!isNaN(a)},email:function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},phone:function(a){var b=/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\.\/0-9]*$/g;return b.test(a)},has:function(a){return!!a.validation},validate:function(a){var b=this,c=[],d=[];return a&&a.validation?(c=a.validation.split(" "),angular.forEach(c,function(c){var e=c.split("="),f=e[0],g=e[1]||null;b[f]?b[f](a.value,g)&&d.push({name:f,value:g}):d.push({name:f})}),c.length===d.length):!0}};return b}]),angular.module("paasb").run(["$templateCache",function(a){a.put("views/directives/searchbox-added-filter.html",'\n<div draggable="true" class="paasb-searchbox-added-filter">\n  <paasb-search-box-filter-operators ng-if="operators" filtering="filtering" filter="filter"></paasb-search-box-filter-operators>\n  <div ng-click="openFilter();" ng-class="{ \'child\': filter.child, \'root\': filter.root }" paasb-search-box-filter-moved="filter" class="paasb-searchbox-added-filter-contents"><span ng-bind="filter.displayName + \':\'" class="filter-name"></span><span ng-bind="filter.selector.name" ng-if="filter.selector" class="selector-type"></span><span ng-bind="filter.value" ng-hide="filter.editing" class="filter-value"></span>\n    <input type="text" ng-model="value" ng-hide="!filter.editing"/><span ng-hide="!filter.loading">Loading...</span>\n    <paasb-search-box-filter-selectors filtering="filtering" filter="filter"></paasb-search-box-filter-selectors>\n    <div ng-if="filter.suggestedValues">\n      <ul ng-hide="!filter.editing" paasb-auto-size="filter" ng-if="!filter.loading">\n        <li ng-repeat="suggestion in filter.suggestedValues | suggest: filter.value:filter" ng-click="takeSuggestion(suggestion.value)"><span ng-bind-html="Utils.trust(suggestion.modified)"></span></li>\n      </ul>\n    </div><i ng-click="destroy();" class="fa fa-times"></i>\n  </div>\n</div>'),a.put("views/directives/searchbox-auto-complete.html",'\n<div ng-hide="!showSuggestions" class="paasb-auto-complete-container">\n  <p>Most Popular Suggestions</p>\n  <ul>\n    <li ng-repeat="suggestion in autoSuggestions" ng-click="takeAutoComplete(suggestion.plainTerm);"><span ng-bind-html="Utils.trust(suggestion.term)" class="suggestion-value"></span><span ng-bind-html="Utils.trust(\' - Suggested &lt;b&gt;\' + suggestion.suggestedCount + \'&lt;/b&gt; times\')" class="suggestion-count"></span></li>\n  </ul>\n</div>'),
a.put("views/directives/searchbox-cache-filters.html",'<i ng-class="{ \'active\': cacheActive }" ng-click="handleCache();" class="paasb-search-box-cache-filter fa fa-archive"></i>'),a.put("views/directives/searchbox-filter-moved-animation.html",'\n<div class="paasb-searchbox-filter-moved-animation"></div>'),a.put("views/directives/searchbox-filter-operators.html",'\n<div ng-hide="!hasOperator" ng-click="openOperators();" class="paasb-searchbox-added-filter-operator"><span><i class="fa fa-arrow-left"></i><i ng-bind="operator.name"></i><i class="fa fa-arrow-right"></i></span>\n  <div ng-hide="!showOperators" class="paasb-searchbox-filter-operators">\n    <ul paasb-auto-size="filter" paasb-auto-size-element="autoSizeElement" paasb-auto-size-bounding-box="autoSizeElement">\n      <li ng-repeat="operator in availableOperators" ng-class="{ \'active\': operator.selected }" ng-click="takeOperator(operator);"><span ng-bind="operator.name"></span></li>\n    </ul>\n  </div>\n</div>'),a.put("views/directives/searchbox-filter-selectors.html",'\n<div ng-class="{ \'loaded\' : !filter.loading }" ng-hide="!filter.editing" class="paasb-searchbox-filter-selectors">\n  <ul paasb-auto-size="filter" paasb-auto-size-element="autoSizeElement">\n    <li ng-repeat="selector in availableSelectors" ng-class="{ \'active\': selector.selected }" ng-click="takeSelector(selector);"><span ng-bind="selector.name"></span></li>\n  </ul>\n</div>'),a.put("views/directives/searchbox-filtering.html",'\n<div class="paasb-filtering paasb-clearfix"><span ng-click="toggleFilters();" ng-class="{ \'active\': active }"><i class="fa fa-filter"></i></span>\n  <ul ng-hide="!active">\n    <li ng-repeat="filter in filters" data-filter-name="{{filter.name}}" ng-class="{ \'child-filter\': filter.child, \'root-filter\': filter.root }" ng-click="addFilter($event);" ng-if="filter.notFiltered"><i class="fa fa-filter"></i><span ng-bind="filter.displayName" class="filter-display-name"></span><span ng-bind-html="Utils.trust(filter.filteredFrom)" class="filtered-from"></span></li>\n  </ul>\n</div>'),a.put("views/directives/searchbox-grouping.html",'\n<div ng-click="addGrouping();" class="paasb-search-box-grouping"><i class="fa fa-plus"></i></div>'),a.put("views/directives/searchbox.html",'\n<div data-search-box="true" class="paasb-searchbox">\n  <paasb-search-box-filtering search="Search" filters="paasbSearchBoxFiltering" ng-if="paasbSearchBoxFiltering &amp;&amp; paasbSearchBoxFiltering.length"></paasb-search-box-filtering>\n  <div class="paasb-searchbox-wrapper"><i ng-class="{ \'fa-search\': !query.length, \'fa-trash\': ((query &amp;&amp; query.length) || hasFilters) }" ng-click="handleGarbage();" paasb-draggable="" draggable="true" class="fa"></i>\n    <paasb-search-box-cache-filter ng-if="paasbSearchBoxCacheFilter"></paasb-search-box-cache-filter><i ng-if="isLoading" ng-class="{ \'no-cache-filtering\': !paasbSearchBoxCacheFilter, \'has-eraser-and-no-cache-filtering\': (hasQuery &amp;&amp; !paasbSearchBoxCacheFilter), \'has-eraser-and-cache-filtering\': (hasQuery &amp;&amp; paasbSearchBoxCacheFilter) }" class="fa fa-cog fa-spin"></i>\n    <input type="text" ng-model="query" id="{{searchInputId}}"/><i ng-if="hasQuery" ng-class="{ \'no-cache-filtering\': !paasbSearchBoxCacheFilter }" ng-click="handleEraser();" class="fa fa-eraser"></i>\n    <paasb-search-box-auto-complete query="searchParams.query" config="paasbSearchBoxAutoComplete" input="input" ng-if="autoCompleteEnabled"></paasb-search-box-auto-complete>\n  </div>\n</div>')}]);